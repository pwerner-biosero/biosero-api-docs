---
id: Order Client
title: Order Client
---

import Protected from '@site/src/components/Protected';

<Protected>

# Order Client 

The `Order Client` is a comprehensive interface for managing laboratory orders and workflows in the Biosero Data Services API. This document provides complete documentation for all available methods and usage patterns for order lifecycle management.

## üìã Table of Contents

- [üîç Overview](#-overview)
- [üèóÔ∏è Constructor](#Ô∏è-constructor)
- [üìù Order Creation Methods](#-order-creation-methods)
- [üìä Order Query Methods](#-order-query-methods)
- [üîç Order Retrieval Methods](#-order-retrieval-methods)
- [üìã Template Management Methods](#-template-management-methods)
- [üîÑ Order Status Methods](#-order-status-methods)
- [üì¶ Assignment Management Methods](#-assignment-management-methods)
- [üõ†Ô∏è Utility Methods](#Ô∏è-utility-methods)
- [‚ö†Ô∏è Error Handling](#Ô∏è-error-handling)
- [üìñ Examples](#-examples)
- [üéØ Best Practices](#-best-practices)

## üîç Overview

The `OrderClient` class provides comprehensive methods for order lifecycle management in laboratory automation workflows. It handles order creation, status tracking, template operations, and assignment management.

**Module:** `biosero.datamodels.clients`  
**Interfaces:** Context Manager Protocol (`__enter__`, `__exit__`)

### Key Features
- Create and manage laboratory orders
- Track order execution and status
- Manage order templates and assignments
- Query orders by various criteria (status, date, assignment)
- Handle order state persistence
- Automatic resource cleanup via context manager

## üèóÔ∏è Constructor

### OrderClient(url)

Creates a new instance of the OrderClient with the specified base URL.

**Parameters:**
- `url` (str or callable): The base URL for the API. If callable, it will be invoked to get the URL.

**Example:**
```python
# Direct URL
client = OrderClient("https://api.example.com")

# Callable URL provider
def get_api_url():
    return "https://api.example.com"

client = OrderClient(get_api_url)
```

### Context Management

The `OrderClient` supports Python's context manager protocol for automatic resource cleanup:

```python
with OrderClient("https://api.example.com") as client:
    order = client.create_order(my_order)
```

## üìù Order Creation Methods

Methods for creating and initializing new orders in the system.

### create_order(order)

Creates a new order in the system.

**Parameters:**
- `order` (Order): Order object containing all order details

**Returns:**
- `str`: JSON response containing order creation details

**Example:**
```python
from biosero.datamodels.ordering import Order
from biosero.datamodels.parameters import ParameterCollection

# Create order
order = Order(
    template_name="Sample Processing",
    parameters=ParameterCollection(),
    priority=1
)

client = OrderClient("https://api.example.com")
result = client.create_order(order)
print(f"Order created: {result}")
```

**API Endpoint:** `POST /api/v2.0/OrderService/Order`

## üìä Order Query Methods

Methods for querying orders based on various criteria with pagination support.

### get_orders(created_on_or_before, limit, offset)

Retrieves orders created on or before a specified date.

**Parameters:**
- `created_on_or_before` (datetime): Cutoff date for order creation
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip (for pagination)

**Returns:**
- `List[Order]`: List of order objects matching the criteria

**Example:**
```python
from datetime import datetime, timedelta

# Get orders from the last week
cutoff_date = datetime.now() - timedelta(days=7)
orders = client.get_orders(cutoff_date, limit=100, offset=0)

for order in orders:
    print(f"Order {order.id}: {order.status}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/Orders?createdOnOrBefore={date}&limit={limit}&offset={offset}`

### get_completed_orders(limit, offset)

Retrieves orders that have completed execution.

**Parameters:**
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of completed orders

**Example:**
```python
completed = client.get_completed_orders(limit=50, offset=0)
print(f"Found {len(completed)} completed orders")
```

**API Endpoint:** `GET /api/v2.0/OrderService/CompletedOrders?limit={limit}&offset={offset}`

### get_executing_orders(limit, offset)

Retrieves orders that are currently executing.

**Parameters:**
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of executing orders

**Example:**
```python
executing = client.get_executing_orders(limit=50, offset=0)
for order in executing:
    print(f"Executing: {order.id} - {order.template_name}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/ExecutingOrders?limit={limit}&offset={offset}`

## üîç Order Retrieval Methods

Methods for retrieving specific orders and their details.

### get_order(order_id)

Retrieves a specific order by its identifier.

**Parameters:**
- `order_id` (str): The unique identifier of the order

**Returns:**
- `Order`: The order object with complete details

**Example:**
```python
order = client.get_order("order-123")
if order:
    print(f"Order: {order.template_name}")
    print(f"Status: {order.status}")
    print(f"Priority: {order.priority}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/Order/{order_id}`

### get_orders_by_assignment(assignment_name, limit, offset)

Retrieves orders filtered by assignment name.

**Parameters:**
- `assignment_name` (str): Name of the assignment to filter by
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of orders with the specified assignment

**Example:**
```python
assigned_orders = client.get_orders_by_assignment("Lab-Station-1", limit=50, offset=0)
for order in assigned_orders:
    print(f"Assigned order: {order.id}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrdersByAssignment?assignmentName={assignment_name}&limit={limit}&offset={offset}`

## üìã Template Management Methods

Methods for managing order templates and template operations.

### get_order_templates()

Retrieves all available order templates.

**Returns:**
- `List[OrderTemplate]`: List of all order templates in the system

**Example:**
```python
templates = client.get_order_templates()
for template in templates:
    print(f"Template: {template.name}")
    print(f"Description: {template.description}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrderTemplates`

### get_order_template(template_name)

Retrieves a specific order template by name.

**Parameters:**
- `template_name` (str): The name of the template to retrieve

**Returns:**
- `OrderTemplate`: The template object with complete configuration

**Example:**
```python
template = client.get_order_template("Sample Processing")
if template:
    print(f"Template: {template.name}")
    print(f"Parameters: {template.parameters}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrderTemplate/{template_name}`

## üîÑ Order Status Methods

Methods for tracking and managing order status throughout the lifecycle.

### get_order_status(order_id)

Retrieves the current status of a specific order.

**Parameters:**
- `order_id` (str): The unique identifier of the order

**Returns:**
- `OrderStatus`: Current status of the order

**Example:**
```python
status = client.get_order_status("order-123")
print(f"Order status: {status}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrderStatus/{order_id}`

### get_orders_by_status(status, limit, offset)

Retrieves orders filtered by their current status.

**Parameters:**
- `status` (OrderStatus): The status to filter by
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of orders with the specified status

**Example:**
```python
from biosero.datamodels.ordering import OrderStatus

pending_orders = client.get_orders_by_status(OrderStatus.PENDING, limit=100, offset=0)
print(f"Found {len(pending_orders)} pending orders")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrdersByStatus?status={status}&limit={limit}&offset={offset}`

## üì¶ Assignment Management Methods

Methods for managing order assignments to specific resources or stations.

### assign_order(order_id, assignment_name)

Assigns an order to a specific resource or station.

**Parameters:**
- `order_id` (str): The unique identifier of the order
- `assignment_name` (str): Name of the resource or station

**Returns:**
- `bool`: True if assignment was successful

**Example:**
```python
success = client.assign_order("order-123", "Lab-Station-1")
if success:
    print("Order assigned successfully")
```

**API Endpoint:** `POST /api/v2.0/OrderService/AssignOrder`

### remove_assignment(order_id)

Removes the current assignment from an order.

**Parameters:**
- `order_id` (str): The unique identifier of the order

**Returns:**
- `bool`: True if assignment removal was successful

**Example:**
```python
success = client.remove_assignment("order-123")
if success:
    print("Assignment removed successfully")
```

**API Endpoint:** `DELETE /api/v2.0/OrderService/Assignment/{order_id}`

## üõ†Ô∏è Utility Methods

Helper methods for data extraction and order manipulation.

### get_parameter_value(parameters, name)

Helper method to extract a specific parameter value from a parameter list.

**Parameters:**
- `parameters`: List of parameter dictionaries
- `name` (str): Name of the parameter to find

**Returns:**
- Value of the parameter if found, otherwise None

**Example:**
```python
order = client.get_order("order-123")
volume = client.get_parameter_value(order.parameters, "Volume")
concentration = client.get_parameter_value(order.parameters, "Concentration")
print(f"Order volume: {volume}, concentration: {concentration}")
```

## ‚ö†Ô∏è Error Handling

The Order Client implements comprehensive error handling strategies:

### HTTP Error Handling
- All methods call `response.raise_for_status()` to handle HTTP errors
- Network errors are propagated as requests exceptions
- Invalid parameters cause ValueError exceptions

### Example Error Handling
```python
try:
    order = client.create_order(my_order)
    print(f"Order created successfully: {order}")
except requests.exceptions.HTTPError as e:
    print(f"HTTP error: {e}")
except requests.exceptions.RequestException as e:
    print(f"Network error: {e}")
except ValueError as e:
    print(f"Invalid parameter: {e}")
```

## üìñ Examples

### Complete Order Workflow Example
```python
from biosero.datamodels.clients import OrderClient
from biosero.datamodels.ordering import Order, OrderStatus
from biosero.datamodels.parameters import ParameterCollection
from datetime import datetime, timedelta

# Initialize client
with OrderClient("https://api.example.com") as client:
    try:
        # Get available templates
        templates = client.get_order_templates()
        print(f"Available templates: {[t.name for t in templates]}")
        
        # Create a new order
        order = Order(
            template_name="Sample Processing",
            parameters=ParameterCollection([
                {"name": "Volume", "value": "100", "unit": "¬µL"},
                {"name": "Temperature", "value": "37", "unit": "¬∞C"}
            ]),
            priority=1
        )
        
        # Submit the order
        result = client.create_order(order)
        order_id = result.get("orderId")
        print(f"Created order: {order_id}")
        
        # Assign to a station
        client.assign_order(order_id, "Lab-Station-1")
        print("Order assigned to Lab-Station-1")
        
        # Monitor order status
        status = client.get_order_status(order_id)
        print(f"Current status: {status}")
        
        # Query recent orders
        recent_date = datetime.now() - timedelta(days=1)
        recent_orders = client.get_orders(recent_date, limit=10, offset=0)
        print(f"Found {len(recent_orders)} recent orders")
        
    except Exception as e:
        print(f"Error occurred: {e}")
```

### Pagination Example
```python
def get_all_completed_orders(client):
    """Retrieve all completed orders using pagination"""
    all_completed = []
    offset = 0
    limit = 100
    
    while True:
        completed = client.get_completed_orders(limit, offset)
        if not completed:
            break
        all_completed.extend(completed)
        offset += limit
    
    return all_completed

# Usage
with OrderClient("https://api.example.com") as client:
    all_completed = get_all_completed_orders(client)
    print(f"Total completed orders: {len(all_completed)}")
```

## üéØ Best Practices

### 1. Use Context Managers
Always use the client within a context manager to ensure proper cleanup:

```python
with OrderClient("https://api.example.com") as client:
    # Your operations here
    pass
```

### 2. Handle Pagination
For methods that support pagination, implement proper pagination logic:

```python
def get_all_orders_by_status(client, status):
    all_orders = []
    offset = 0
    limit = 100
    
    while True:
        orders = client.get_orders_by_status(status, limit, offset)
        if not orders:
            break
        all_orders.extend(orders)
        offset += limit
    
    return all_orders
```

### 3. Error Handling
Implement comprehensive error handling for network and API errors:

```python
try:
    order = client.create_order(my_order)
except requests.exceptions.HTTPError as e:
    if e.response.status_code == 409:
        print("Order already exists")
    else:
        print(f"HTTP error: {e}")
except requests.exceptions.RequestException as e:
    print(f"Network error: {e}")
```

### 4. Parameter Management
Use the helper method for safe parameter extraction:

```python
order = client.get_order("order-123")
volume = client.get_parameter_value(order.parameters, "Volume")
if volume:
    print(f"Order volume: {volume}")
```

### 5. Performance Considerations
- **Connection Reuse**: HTTP connections are reused through the internal session
- **Template Caching**: Cache frequently used templates client-side
- **Status Polling**: Use reasonable intervals for status checking
- **Pagination**: Use appropriate page sizes for large queries
- **Resource Cleanup**: Always dispose of clients to free resources

## üîó Related Data Models

The Order Client works with several data models from the `biosero.datamodels` package:

- **Order**: Core order objects with parameters, status, and execution details
- **OrderTemplate**: Reusable order definitions with parameter specifications
- **OrderStatus**: Enum representing order lifecycle states (Pending, Executing, Completed, etc.)
- **OrderDto**: Data transfer object for API communication
- **ParameterCollection**: Collections of order parameters with validation
- **Assignment**: Resource assignment information for order execution

## üßµ Thread Safety

The `OrderClient` uses a `requests.Session` object internally. While `requests.Session` is generally thread-safe for reading operations, it's recommended to create separate client instances for different threads when performing write operations.

## Order Management

### `create_order(order)`

Creates a new order in the system.

**Parameters:**
- `order` (Order): Order object containing all order details

**Returns:**
- `str`: JSON response containing order creation details

**Example:**
```python
from biosero.datamodels.ordering import Order
from biosero.datamodels.parameters import ParameterCollection

# Create order
order = Order(
    template_name="Sample Processing",
    parameters=ParameterCollection(),
    priority=1
)

client = OrderClient(url="https://api.example.com")
result = client.create_order(order)
print(f"Order created: {result}")
```

**API Endpoint:** `POST /api/v2.0/OrderService/CreateOrder`

### `get_order(order_id)`

Retrieves a specific order by its identifier.

**Parameters:**
- `order_id` (str): Unique identifier of the order

**Returns:**
- `Order`: Complete order object with all details

**Example:**
```python
order = client.get_order("order-123")
print(f"Order status: {order.status}")
print(f"Created: {order.created_date}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/Order?orderId={order_id}`

### `update_order(order)`

Updates an existing order with new information.

**Parameters:**
- `order` (Order): Updated order object

**Example:**
```python
order = client.get_order("order-123")
order.priority = 5
client.update_order(order)
```

**API Endpoint:** `POST /api/v2.0/OrderService/UpdateOrder`

## Order Status Management

### `get_order_status(order_id)`

Retrieves the current status of an order.

**Parameters:**
- `order_id` (str): Unique identifier of the order

**Returns:**
- `OrderStatus`: Enum value representing the current status

**Example:**
```python
status = client.get_order_status("order-123")
print(f"Current status: {status.name}")

# Check specific status
if status == OrderStatus.EXECUTING:
    print("Order is currently executing")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrderStatus?orderId={order_id}`

### `update_order_status(order_id, status, details)`

Updates the status of an order with additional details.

**Parameters:**
- `order_id` (str): Unique identifier of the order
- `status` (OrderStatus): New status for the order
- `details` (str): Additional information about the status change

**Example:**
```python
from biosero.datamodels.ordering import OrderStatus

client.update_order_status(
    order_id="order-123",
    status=OrderStatus.COMPLETED,
    details="Processing completed successfully"
)
```

**API Endpoint:** `POST /api/v2.0/OrderService/UpdateOrderStatus?orderId={order_id}&status={status}`

## Order Queries

### `get_orders(created_on_or_before, limit, offset)`

Retrieves orders created on or before a specific date with pagination.

**Parameters:**
- `created_on_or_before` (datetime): Date threshold for order retrieval
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip (for pagination)

**Returns:**
- `List[Order]`: List of order objects

**Example:**
```python
from datetime import datetime, timedelta

# Get orders from the last week
cutoff_date = datetime.now() - timedelta(days=7)
orders = client.get_orders(cutoff_date, limit=100, offset=0)

for order in orders:
    print(f"Order {order.id}: {order.status}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/Orders?createdOnOrBefore={date}&limit={limit}&offset={offset}`

### `get_completed_orders(limit, offset)`

Retrieves orders that have completed execution.

**Parameters:**
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of completed orders

**Example:**
```python
completed = client.get_completed_orders(limit=50, offset=0)
print(f"Found {len(completed)} completed orders")
```

**API Endpoint:** `GET /api/v2.0/OrderService/CompletedOrders?limit={limit}&offset={offset}`

### `get_executing_orders(limit, offset)`

Retrieves orders that are currently executing.

**Parameters:**
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of executing orders

**Example:**
```python
executing = client.get_executing_orders(limit=50, offset=0)
for order in executing:
    print(f"Executing: {order.id} - {order.template_name}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/ExecutingOrders?limit={limit}&offset={offset}`

### `get_unassigned_orders(limit, offset)`

Retrieves orders that haven't been assigned to any equipment or resource.

**Parameters:**
- `limit` (int): Maximum number of orders to return
- `offset` (int): Number of orders to skip

**Returns:**
- `List[Order]`: List of unassigned orders

**Example:**
```python
unassigned = client.get_unassigned_orders(limit=50, offset=0)
print(f"Found {len(unassigned)} unassigned orders")
```

**API Endpoint:** `GET /api/v2.0/OrderService/UnassignedOrders?limit={limit}&offset={offset}`

## Order Template Management

### `get_order_templates(limit, offset)`

Retrieves available order templates with pagination.

**Parameters:**
- `limit` (int): Maximum number of templates to return
- `offset` (int): Number of templates to skip

**Returns:**
- `List[OrderTemplate]`: List of order template objects

**Example:**
```python
templates = client.get_order_templates(limit=20, offset=0)
for template in templates:
    print(f"Template: {template.name}")
    print(f"Description: {template.description}")
```

**API Endpoint:** `GET /api/v2.0/OrderService/OrderTemplates?limit={limit}&offset={offset}`

### `register_order_template(template)`

Registers a new order template in the system.

**Parameters:**
- `template` (OrderTemplate): Template object to register

**Example:**
```python
from biosero.datamodels.ordering import OrderTemplate

template = OrderTemplate(
    name="New Sample Processing",
    description="Template for processing biological samples",
    parameters=ParameterCollection()
)

client.register_order_template(template)
print("Template registered successfully")
```

**API Endpoint:** `POST /api/v2.0/OrderService/RegisterOrderTemplate`

### `delete_order_template(template_name)`

Removes an order template from the system.

**Parameters:**
- `template_name` (str): Name of the template to delete

**Example:**
```python
client.delete_order_template("Old Processing Template")
```

**API Endpoint:** `DELETE /api/v2.0/OrderService/DeleteOrderTemplate?templateName={template_name}`

## Order Assignment and State

### `try_assign_order(order_id, identifier_to_assign_to)`

Attempts to assign an order to a specific resource or equipment.

**Parameters:**
- `order_id` (str): Unique identifier of the order
- `identifier_to_assign_to` (str): Identifier of the resource to assign to

**Returns:**
- `bool`: True if assignment was successful

**Example:**
```python
success = client.try_assign_order("order-123", "robot-arm-1")
if success:
    print("Order assigned successfully")
else:
    print("Assignment failed - resource may be busy")
```

**API Endpoint:** `POST /api/v2.0/OrderService/TryAssignOrder?orderId={order_id}&to={identifier}`

### `persist_state(order_id, state)`

Saves the current state of an order for persistence across system restarts.

**Parameters:**
- `order_id` (str): Unique identifier of the order
- `state` (str): State data to persist

**Example:**
```python
state_data = json.dumps({
    "current_step": 3,
    "processed_samples": 15,
    "remaining_time": "00:45:00"
})

client.persist_state("order-123", state_data)
```

**API Endpoint:** `POST /api/v2.0/OrderService/PersistState?orderId={order_id}`

### `set_output_parameters(order_id, parameters)`

Sets output parameters for an order after processing.

**Parameters:**
- `order_id` (str): Unique identifier of the order
- `parameters` (Dict[str, str]): Dictionary of output parameters

**Example:**
```python
output_params = {
    "total_samples_processed": "24",
    "processing_time": "02:15:30",
    "quality_score": "98.5"
}

client.set_output_parameters("order-123", output_params)
```

**API Endpoint:** `POST /api/v2.0/OrderService/SetOutputParameters?orderId={order_id}`

## Utility Methods

### `get_parameter_value(parameters, name)`

Helper method to extract a specific parameter value from a parameter list.

**Parameters:**
- `parameters`: List of parameter dictionaries
- `name` (str): Name of the parameter to find

**Returns:**
- Value of the parameter if found, otherwise None

**Example:**
```python
order = client.get_order("order-123")
volume = client.get_parameter_value(order.parameters, "Volume")
print(f"Order volume: {volume}")
```

## Error Handling

The Order Client implements comprehensive error handling:

### HTTP Error Handling
- All methods call `response.raise_for_status()` to handle HTTP errors
- Network errors are propagated as requests exceptions
- Invalid parameters cause ValueError exceptions

### Example Error Handling
```python
try:
    order = client.create_order(my_order)
except requests.exceptions.HTTPError as e:
    print(f"HTTP error: {e}")
except requests.exceptions.RequestException as e:
    print(f"Network error: {e}")
except ValueError as e:
    print(f"Invalid parameter: {e}")
```


## Data Models

The Order Client works with several key data models:

- **Order**: Core order objects with parameters, status, and execution details
- **OrderTemplate**: Reusable order definitions
- **OrderStatus**: Enum representing order lifecycle states
- **OrderDto**: Data transfer object for API communication
- **ParameterCollection**: Collections of order parameters

## Thread Safety

The OrderClient uses a requests.Session internally. While generally thread-safe for read operations, create separate client instances for different threads when performing write operations.

## Performance Considerations

1. **Connection Reuse**: HTTP connections are reused through the internal session
2. **Pagination**: Use appropriate page sizes for large queries
3. **Template Caching**: Cache frequently used templates client-side
4. **Status Polling**: Use reasonable intervals for status checking
5. **Resource Cleanup**: Always dispose of clients to free resources

## API Versioning

The Order Client uses API version 2.0:
- **Base path**: `/api/v2.0/OrderService/`
- **Consistent endpoints**: All operations use the same API version

---

*This client provides comprehensive order management functionality and is essential for laboratory workflow automation in the Biosero ecosystem.*

</Protected>